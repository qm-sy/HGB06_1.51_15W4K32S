C51 COMPILER V9.60.7.0   KEY                                                               04/03/2025 14:49:14 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Output\key.obj
COMPILER INVOKED BY: D:\APP\Keil_v5\C51\BIN\C51.EXE Src\key.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Inc;D:\APP\Keil_v5
                    -\C51\INC) DEBUG OBJECTEXTEND PRINT(.\Listings\key.lst) OBJECT(.\Output\key.obj)

line level    source

   1          #include "STC15W4Kxx.h"
   2          #include "key.h"
   3          #include "stdint.h"
   4          #include "timer.h"
   5          #include "pwm.h"
   6          #include "screen.h"
   7          #include "delay.h"
   8          #include "eeprom.h"
   9          #include "stdio.h"
  10          #include "sync.h"
  11          
  12          bit on_off = 1;
  13          
  14          bit sync_bit = 0;
  15          
  16          uint8_t wind_num = 0;
  17          uint8_t power_num = 0;
  18          uint8_t mode_num = 0;
  19          uint8_t temp_num = 45;
  20          
  21          uint8_t key_val = 0;
  22          
  23          uint8_t mode_info[6];
  24          uint8_t alarm_dis_flag = 0;
  25          bit sync_delay_bit = 0;
  26          bit temp_delay_bit = 0;
  27          
  28          
  29          void button_scan()
  30          {
  31   1          uint8_t continue_cnt1;
  32   1          uint8_t continue_cnt2;
  33   1          uint8_t continue_cnt3;
  34   1          if(scan_start_bit == 1)
  35   1          {
  36   2              switch(key_val)
  37   2              {
  38   3      //            case PowerKey:
  39   3      //                power_key();
  40   3      //                break;
  41   3                  
  42   3                  case UpKey:
  43   3                      up_key();
  44   3                      button_scan_flag = 1;
  45   3                      button_scan_cnt = 0;
  46   3                      delay_ms(50);
  47   3                      break;
  48   3                  
  49   3                  case ChannelChoose:
  50   3                      continue_cnt1 = 100;
  51   3                      while((key_val==ChannelChoose)&&(continue_cnt1>0))
  52   3                      {
  53   4                          continue_cnt1--; 
  54   4                          delay_ms(10);
C51 COMPILER V9.60.7.0   KEY                                                               04/03/2025 14:49:14 PAGE 2   

  55   4                      }
  56   3                      if(continue_cnt1 == 0)           //ï¿½ï¿½ï¿½ï¿½1sï¿½Ð¶Ï£ï¿½ï¿½ï¿½ï¿½ï¿½Í¬ï¿½ï¿½ 
  57   3                      {
  58   4                          fan_delay_set();
  59   4                      }
  60   3      
  61   3                      if(temp_delay_bit == 0)         //ï¿½Ì°ï¿½ï¿½ï¿½modeï¿½Ð»ï¿½
  62   3                      {
  63   4                          channel_choose();
  64   4                      }
  65   3                      button_scan_flag = 1;
  66   3                      button_scan_cnt = 0;
  67   3                      delay_ms(50);
  68   3                      break;
  69   3      
  70   3                  case FunctionKey:
  71   3                      continue_cnt3 = 100;
  72   3                      while((key_val==FunctionKey)&&(continue_cnt3>0))
  73   3                      {
  74   4                          continue_cnt3--; 
  75   4                          delay_ms(10);
  76   4                      }
  77   3                      if(continue_cnt3 == 0)           //ï¿½ï¿½ï¿½ï¿½1sï¿½Ð¶Ï£ï¿½ï¿½ï¿½ï¿½ï¿½Í¬ï¿½ï¿½ 
  78   3                      {
  79   4                          temp_set();
  80   4                      }
  81   3                      button_scan_flag = 1;
  82   3                      button_scan_cnt = 0;
  83   3                      break;
  84   3      
  85   3                  case ModeChoose:                    //ï¿½ï¿½ï¿½ï¿½Í¬ï¿½ï¿½ï¿½Ð»ï¿½ï¿½ï¿½modeï¿½Ð»ï¿½
  86   3                      continue_cnt2 = 100;
  87   3                      while((key_val==ModeChoose)&&(continue_cnt2>0))
  88   3                      {
  89   4                          continue_cnt2--; 
  90   4                          delay_ms(10);
  91   4                      }
  92   3                      
  93   3                      if(continue_cnt2 == 0)           //ï¿½ï¿½ï¿½ï¿½1sï¿½Ð¶Ï£ï¿½ï¿½ï¿½ï¿½ï¿½Í¬ï¿½ï¿½ 
  94   3                      {
  95   4                          sync_choose();
  96   4                      }
  97   3      
  98   3                      if(sync_delay_bit == 0)         //ï¿½Ì°ï¿½ï¿½ï¿½modeï¿½Ð»ï¿½
  99   3                      {
 100   4                          mode_choose();
 101   4                      }
 102   3                      button_scan_flag = 1;
 103   3                      button_scan_cnt = 0;
 104   3                      delay_ms(50);
 105   3                      break;
 106   3                      
 107   3                  case DownKey:
 108   3                      down_key();
 109   3                      button_scan_flag = 1;
 110   3                      button_scan_cnt = 0;
 111   3                      delay_ms(50);
 112   3                      break;
 113   3                  
 114   3                  case FanUp:
 115   3                      fan_up();   
 116   3                      button_scan_flag = 1;
C51 COMPILER V9.60.7.0   KEY                                                               04/03/2025 14:49:14 PAGE 3   

 117   3                      button_scan_cnt = 0;
 118   3                      delay_ms(50); 
 119   3                      break;
 120   3                  
 121   3                  case FanDown:
 122   3                      fan_down();   
 123   3                      button_scan_flag = 1;     
 124   3                      button_scan_cnt = 0;  
 125   3                      delay_ms(50);
 126   3                      break;
 127   3      
 128   3              }
 129   2              if(power_bit==1)
 130   2              {
 131   3                  sun_dis(DIS_ON);
 132   3              }
 133   2              scan_stop_bit = 1;
 134   2              scan_start_bit = 0;
 135   2          }
 136   1      }
 137          
 138          void fan_up()
 139          {
 140   1          char up_num1 = 0;
 141   1          up_num1 = wind_num;
 142   1          
 143   1          buzzer=buzzer_bit=0;
 144   1          
 145   1          up_num1 += 1;
 146   1          if(up_num1>6)
 147   1          {
 148   2              up_num1 = 6;
 149   2          }
 150   1          
 151   1          wind_num = up_num1;
 152   1          wind_crl(wind_num);
 153   1          wind_dis(wind_num);
 154   1          
 155   1          eeprom_data_write();
 156   1      }
 157          
 158          void fan_down()
 159          {
 160   1          char down_num1 = 0;
 161   1          down_num1 = wind_num;
 162   1          
 163   1          buzzer=buzzer_bit=0;
 164   1          
 165   1          down_num1 -= 1;
 166   1          if(down_num1<0)
 167   1          {
 168   2              down_num1 = 0;
 169   2          }
 170   1      
 171   1          wind_num = down_num1;
 172   1          wind_crl(wind_num);
 173   1          wind_dis(wind_num);
 174   1          
 175   1          eeprom_data_write();
 176   1      }
 177          
 178          void up_key()
C51 COMPILER V9.60.7.0   KEY                                                               04/03/2025 14:49:14 PAGE 4   

 179          {
 180   1          char up_num2 = 0;
 181   1          up_num2 = power_num;
 182   1          
 183   1          buzzer=buzzer_bit=0;
 184   1          
 185   1          up_num2 += 5;
 186   1          if(up_num2>100)
 187   1          {
 188   2              up_num2 = 100;
 189   2          }
 190   1          
 191   1          power_num = up_num2;
 192   1          power_crl(power_num);
 193   1          num_dis(power_num);
 194   1          channel_dis(channel_num);
 195   1          percentage_dis(DIS_ON);
 196   1          
 197   1          eeprom_data_write();
 198   1      }
 199          
 200          void down_key()
 201          {
 202   1          char down_num2 = 0;
 203   1          down_num2 = power_num;
 204   1          
 205   1          buzzer=buzzer_bit=0;
 206   1          
 207   1          down_num2 -= 5;
 208   1          if(down_num2<0)
 209   1          {
 210   2              down_num2 = 0;
 211   2          }
 212   1          
 213   1          power_num = down_num2;
 214   1          power_crl(power_num);
 215   1          num_dis(power_num);
 216   1          channel_dis(channel_num);
 217   1          percentage_dis(DIS_ON);
 218   1          
 219   1          eeprom_data_write();
 220   1      }
 221          
 222          void channel_choose()
 223          {
 224   1          buzzer=buzzer_bit=0;
 225   1          
 226   1          if(channel_num==3)
 227   1          {
 228   2              channel_num = 1;
 229   2          }
 230   1          else
 231   1          {
 232   2              channel_num += 1;
 233   2          }
 234   1          channel_dis(channel_num);
 235   1      
 236   1          if(power_bit==1)
 237   1          {
 238   2              sun_dis(DIS_ON);
 239   2          }
 240   1          eeprom_data_write();
C51 COMPILER V9.60.7.0   KEY                                                               04/03/2025 14:49:14 PAGE 5   

 241   1      }
 242          
 243          void fan_delay_set()
 244          {
 245   1          unsigned char num3 = 0;
 246   1          num3 = fengshan_delay;
 247   1          
 248   1          buzzer=buzzer_bit=0;
 249   1          delay_ms(500);
 250   1          while(key_val!=ChannelChoose)
 251   1          {
 252   2              if(temp_dis_bit)
 253   2              {
 254   3                  num_dis(fengshan_delay);
 255   3                  //Celsius_dis(DIS_ON);
 256   3                  
 257   3              }
 258   2              if(~temp_dis_bit)
 259   2              {
 260   3                  lcd_write_val(addr_tab[ADDR_0B],0x00);
 261   3      
 262   3                  lcd_write_val(addr_tab[ADDR_0A],0X00);
 263   3      
 264   3                  lcd_write_val(addr_tab[ADDR_07],0X00);
 265   3      
 266   3                  lcd_write_val(addr_tab[ADDR_06],0X00);
 267   3                  
 268   3                  //Celsius_dis(DIS_ON);
 269   3                  
 270   3              }
 271   2              if(key_val == UpKey)
 272   2              {
 273   3                  buzzer=buzzer_bit=0;
 274   3                  num3+=1;
 275   3                  if(num3>200)
 276   3                  {
 277   4                      num3 = 200;
 278   4                  }
 279   3                  fengshan_delay = num3;
 280   3      
 281   3                  delay_ms(100);
 282   3              }
 283   2              if(key_val == DownKey)
 284   2              {
 285   3                  buzzer=buzzer_bit=0;
 286   3                  num3-=1;
 287   3                  if(num3<2)
 288   3                  {
 289   4                      num3 = 1;
 290   4                  }
 291   3                  fengshan_delay = num3;
 292   3      
 293   3                  delay_ms(100);
 294   3              }
 295   2              button_scan_flag = 1;
 296   2              button_scan_cnt = 0;
 297   2          }
 298   1          temp_delay_bit = 1;
 299   1          num_dis(power_num);           
 300   1          channel_dis(channel_num);
 301   1          Celsius_dis(DIS_OFF);
 302   1          percentage_dis(DIS_ON);
C51 COMPILER V9.60.7.0   KEY                                                               04/03/2025 14:49:14 PAGE 6   

 303   1          if(power_bit==1)
 304   1          {
 305   2              sun_dis(DIS_ON);
 306   2          }
 307   1          eeprom_data_write();
 308   1      }
 309          
 310          void temp_set()
 311          {
 312   1          unsigned char num3 = 0;
 313   1          num3 = temp_num;
 314   1          
 315   1          buzzer=buzzer_bit=0;
 316   1          alarm_dis(alarm_dis_flag);
 317   1          delay_ms(500);
 318   1          while(key_val!=FunctionKey)
 319   1          {
 320   2              if(temp_dis_bit)
 321   2              {
 322   3                  num_dis(temp_num);
 323   3                  Celsius_dis(DIS_ON);
 324   3                  
 325   3              }
 326   2              if(~temp_dis_bit)
 327   2              {
 328   3                  lcd_write_val(addr_tab[ADDR_0B],0x00);
 329   3      
 330   3                  lcd_write_val(addr_tab[ADDR_0A],0X00);
 331   3      
 332   3                  lcd_write_val(addr_tab[ADDR_07],0X00);
 333   3      
 334   3                  lcd_write_val(addr_tab[ADDR_06],0X00);
 335   3                  
 336   3                  Celsius_dis(DIS_ON);
 337   3                  
 338   3              }
 339   2              if(key_val == UpKey)
 340   2              {
 341   3                  buzzer=buzzer_bit=0;
 342   3                  num3+=1;
 343   3                  if(num3>120)
 344   3                  {
 345   4                      num3 = 120;
 346   4                  }
 347   3                  temp_num = num3;
 348   3      
 349   3                  delay_ms(100);
 350   3              }
 351   2              if(key_val == DownKey)
 352   2              {
 353   3                  buzzer=buzzer_bit=0;
 354   3                  num3-=1;
 355   3                  if(num3<20)
 356   3                  {
 357   4                      num3 = 20;
 358   4                  }
 359   3                  temp_num = num3;
 360   3      
 361   3                  delay_ms(100);
 362   3              }
 363   2              if(key_val == ModeChoose)
 364   2              {
C51 COMPILER V9.60.7.0   KEY                                                               04/03/2025 14:49:14 PAGE 7   

 365   3                  buzzer=buzzer_bit=0;
 366   3                  alarm_dis_flag = 1 - alarm_dis_flag;
 367   3                  alarm_dis(alarm_dis_flag);
 368   3                  delay_ms(100);
 369   3              }
 370   2              button_scan_flag = 1;
 371   2              button_scan_cnt = 0;
 372   2          }
 373   1          
 374   1          temp_delay_bit = 1;         //ï¿½ï¿½Ê±1s  ï¿½ï¿½Ö¹ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ì°ï¿½ï¿½ï¿½ 
 375   1          
 376   1          num_dis(power_num);           
 377   1          channel_dis(channel_num);
 378   1          Celsius_dis(DIS_OFF);
 379   1          percentage_dis(DIS_ON);
 380   1          alarm_dis(DIS_OFF);
 381   1          if(power_bit==1)
 382   1          {
 383   2              sun_dis(DIS_ON);
 384   2          }
 385   1          eeprom_data_write();
 386   1      }
 387          
 388          void mode_choose()
 389          {
 390   1          buzzer=buzzer_bit=0;
 391   1          mode_num += 1;
 392   1          if(mode_num==6)
 393   1          {
 394   2              mode_num = 1;
 395   2          }
 396   1          
 397   1          lcd_clear();                //Ò»ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
 398   1          
 399   1          percentage_dis(DIS_OFF);
 400   1          mode_dis(DIS_ON);       
 401   1          num_dis(mode_num);           //ï¿½ï¿½Ê¾Ä£Ê½ï¿½ï¿½ÅºÍ±ï¿½Ö?
 402   1            
 403   1          eeprom_data_read(mode_num);  //ï¿½ï¿½È¡channel_numï¿½ï¿½sync_bitï¿½ï¿½wind_numï¿½ï¿½power_num
 404   1              
 405   1          delay_ms(500);
 406   1          
 407   1          lcd_clear();                 //ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
 408   1          
 409   1          mode_dis(DIS_OFF);
 410   1          sun_dis(~sync_bit);
 411   1          sync_dis(sync_bit);
 412   1          num_dis(power_num);
 413   1          channel_dis(channel_num);
 414   1          percentage_dis(DIS_ON);
 415   1          wind_dis(wind_num);          //Ë¢ï¿½Â½ï¿½ï¿½æ£ºï¿½ï¿½ï¿½È·ï¿½ï¿½Å¡ï¿½Í¨ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¡ï¿½ï¿½Ù·
             -Ö±È¡ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Í¬ï¿½ï¿½ï¿½ï¿½Ö¾
 416   1          delay_bit1 = 0;
 417   1          delay_bit2 = 0;
 418   1      
 419   1          sync_judge();               //ï¿½Ð¶ï¿½Í¬ï¿½ï¿½×´Ì¬
 420   1      
 421   1          temp_listen();
 422   1      
 423   1          eeprom_mode_save();         //ï¿½ï¿½Â¼Ä£Ê½ï¿½ï¿½ï¿?
 424   1      }
 425          
C51 COMPILER V9.60.7.0   KEY                                                               04/03/2025 14:49:14 PAGE 8   

 426          void sync_choose()
 427          {
 428   1          buzzer=buzzer_bit=0;
 429   1      
 430   1          sync_delay_bit = 1;         //ï¿½ï¿½Ê±1s  ï¿½ï¿½Ö¹ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ì°ï¿½ï¿½ï¿½ 
 431   1      
 432   1          sync_bit = ~sync_bit;       //Í¬ï¿½ï¿½ï¿½ï¿½orï¿½ï¿½
 433   1          sync_dis(sync_bit);
 434   1      
 435   1          sync_judge();
 436   1      
 437   1          eeprom_data_write();        //ï¿½ï¿½Â¼Í¬ï¿½ï¿½×´Ì¬
 438   1      }
 439          
 440          //void power_key()
 441          //{
 442          //   lcd_clear();
 443          //}
 444          
 445          void fan_rotate()
 446          {
 447   1          fan_center_dis(DIS_ON);
 448   1          if((wind_bit == 1)&&(wind_num>0))
 449   1          {
 450   2              fan_leaf1_dis(fan_dis_bit);
 451   2              fan_leaf2_dis(~fan_dis_bit);
 452   2          }
 453   1          else
 454   1          {
 455   2              fan_leaf1_dis(DIS_ON);
 456   2              fan_leaf2_dis(DIS_OFF);
 457   2          }
 458   1      }
 459          
 460          uint8_t power_on()
 461          {
 462   1          if(scan_start_bit == 1)
 463   1          {
 464   2              if(key_val == PowerKey)
 465   2              {
 466   3                  button_scan_flag = 1;
 467   3                  button_scan_cnt = 0;
 468   3                  return 0;
 469   3              }
 470   2          }
 471   1          return 1;
 472   1      }
 473          
 474          void power_off()
 475          {
 476   1          uint8_t continue_cnt;
 477   1          if(scan_start_bit == 1)
 478   1          {
 479   2              continue_cnt = 100;
 480   2              while((key_val==PowerKey)&&(continue_cnt>0))
 481   2              {
 482   3                  continue_cnt--; 
 483   3                  delay_ms(10);
 484   3              }
 485   2              if(continue_cnt == 0)           //ï¿½ï¿½ï¿½ï¿½1sï¿½Ð¶Ï£ï¿½ï¿½ï¿½ï¿½ï¿½Í¬ï¿½ï¿½ 
 486   2              {
 487   3                  lcd_clear();
C51 COMPILER V9.60.7.0   KEY                                                               04/03/2025 14:49:14 PAGE 9   

 488   3                  power_bit = 0;
 489   3                  sun_dis(DIS_OFF);
 490   3                  PWMStop();
 491   3                  on_off = 1;
 492   3              }
 493   2          }
 494   1      
 495   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1246    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     12       6
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      4    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
